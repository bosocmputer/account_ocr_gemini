// prompt_vendor_matching.go - Vendor/Customer matching guidance
package ai

// GetVendorMatchingGuidance returns fuzzy matching rules for Creditors/Debtors
func GetVendorMatchingGuidance() string {
	return `
🎯 PRE-MATCHED VENDOR (ถ้ามี):
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

⚠️ **CRITICAL: ถ้าระบบให้ค่า suggested_vendor_code มา → ใช้เลย ไม่ต้องค้นหาใหม่!**

ระบบได้ทำ fuzzy matching ล่วงหน้าแล้ว ด้วย algorithm ที่แม่นยำ:
- ถ้า method = "tax_id" → จับคู่ด้วย Tax ID (100% แม่นยำ)
- ถ้า method = "exact" → ชื่อตรงกันพอดี (99%+)
- ถ้า method = "fuzzy" → ชื่อใกล้เคียง (70-99%)

**วิธีใช้:**
1. ถ้ามี suggested_vendor_code → ใช้ creditor_code = suggested_vendor_code
2. ใช้ creditor_name จาก Master Data ที่ตรงกับ code นั้น
3. ไม่ต้อง fuzzy match ใหม่ในขั้น AI

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🔍 (ถ้าไม่มี pre-matched) - การจับคู่ชื่อภาษาไทย (Thai Name Matching):
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

**ปัญหาที่พบบ่อย:**
- OCR อาจอ่านผิด: "[ชื่อบริษัท]" อาจกลายเป็น "[ชื่อสะกดต่าง 1]", "[ชื่อสะกดต่าง 2]"
- ชื่อย่อ: "บจก." vs "บริษัท จำกัด"
- พิมพ์ผิด: "สำนักงานใหญ่" vs "สำนักงานใหญ่่"
- ตัวสะกด: "เชียงใหม่" vs "เชียงใหม่่"

**วิธีการจับคู่ที่ถูกต้อง (Fuzzy Matching Algorithm):**

1️⃣ **NORMALIZE ชื่อก่อนเปรียบเทียบ (สำคัญมาก!):**
   
   ทั้ง 2 ฝั่ง (เอกสาร + Master) ต้อง normalize ก่อน:
   
   a) **ตัวอักษรพิเศษภาษาไทย:**
      - ตัวสะกดซ้ำ: "ล", "ลล์", "ล์" → ให้เหมือนกัน (เช่น "ฮิล" = "ฮิลล์")
      - วรรณยุกต์ซ้ำ: "ใหม่", "ใหม่่" → เอา ่ ซ้ำออก
      - สระซ้ำ: "เออ", "เอ" → ให้เหมือนกัน
   
   b) **คำย่อ/คำเต็ม:**
      - "บริษัท", "บจก.", "บมจ.", "บจำกัด" → ให้เหมือนกัน
      - "ห้างหุ้นส่วน", "หจก.", "ห.จำกัด" → ให้เหมือนกัน
      - "สำนักงานใหญ่", "(สำนักงานใหญ่)", "head office" → ละทิ้ง
   
   c) **คำเชื่อม/สัญลักษณ์:**
      - "และ", "&", "แอนด์", "and" → ให้เหมือนกัน
      - ช่องว่างเกิน, วงเล็บ, ขีดกลาง → เอาออก

2️⃣ **ดึงคำสำคัญ (Core Keywords):**
   - ละคำทั่วไป: "บริษัท", "จำกัด", "สำนักงานใหญ่"
   - เก็บเฉพาะชื่อเฉพาะ: "[ชื่อหลัก 1]", "[ชื่อหลัก 2]", "[ชื่อหลัก 3]"

3️⃣ **คำนวณความคล้าย (Similarity) แต่ละคำ:**
   - เปรียบเทียบแต่ละคำสำคัญ
   - ยอมรับถ้า ≥ 70% (ต่างได้ 3-4 ตัวอักษรใน 10 ตัว)

4️⃣ **ตัวอย่าง Normalization + Matching:**

   **ตัวอย่างที่ 1:**
   - เอกสาร: "[ประเภทนิติบุคคล] [ชื่อบริษัท] (สำนักงานใหญ่)"
   - Master: "[ประเภทนิติบุคคล] [ชื่อคล้ายกัน]"
   
   Normalize → "[ชื่อหลัก]" vs "[ชื่อหลัก]" (ตัดคำทั่วไป + normalize ตัวสะกด)
   → Match 100% ✅

   **ตัวอย่างที่ 2:**
   - เอกสาร: "[ย่อ][ชื่อบริษัท]"  
   - Master: "[เต็ม] [ชื่อบริษัท]"
   
   Normalize → "[ชื่อหลัก]" vs "[ชื่อหลัก]"
   → Match 100% ✅

   **ตัวอย่างที่ 3:**
   - เอกสาร: "[ย่อ][ชื่อบริษัทติดกัน]"
   - Master: "[ประเภท] [ชื่อ บริษัท เว้นวรรค] (มหาชน)"
   
   Normalize → "[ชื่อหลัก]" vs "[ชื่อหลัก]" (เอาช่องว่างออก)
   → Match 100% ✅

5️⃣ **กฎการตัดสิน (Decision Rules):**
   - ≥ 90%: Match แน่นอน → ใช้ code + name จาก Master
   - 70-89%: Match น่าจะใช่ → ใช้ได้ (ระบุ fuzzy_match)
   - 50-69%: ไม่แน่ใจ → ใช้ Unknown (แนะนำให้ user เพิ่ม Master)
   - < 50%: ไม่ตรง → Unknown Vendor/Customer

6️⃣ **ตัวอย่าง Step-by-step:**

   จาก OCR: "บริษัท [ชื่อบริษัท A] จำกัด"
   Master มี: ["บริษัท [ชื่อคล้าย A] จำกัด", "บริษัท B จำกัด"]
   
   PROCESS:
   Step 1: Normalize เอกสาร
   "บริษัท [ชื่อบริษัท A] จำกัด" → "[ส่วนหลัก A]"
   
   Step 2: Normalize Master ทุกตัว
   "บริษัท [ชื่อคล้าย A] จำกัด" → "[ส่วนหลัก A]"
   "บริษัท B จำกัด" → "b"
   
   Step 3: เปรียบเทียบ
   "[ส่วนหลัก A]" vs "[ส่วนหลัก A]" → 95-100% ✅
   "[ส่วนหลัก A]" vs "b" → 0% ❌
   
   Step 4: เลือก Match ที่ดีที่สุด
   → ใช้ "บริษัท [ชื่อคล้าย A] จำกัด" (code: AR001)

🚫 **CRITICAL: ห้าม Match แบบผิด ๆ:**
   ❌ ห้าม match บริษัทคนละบริษัทเพียงเพราะชื่อคล้ายกัน!
   ❌ ห้าม match ด้วย "ประเภทธุรกิจ" → **ห้าม!** ต้อง match ด้วยชื่อเท่านั้น

7️⃣ **Tax ID Matching (กรณีพิเศษ):**
   - ถ้า Tax ID ตรงกัน → Match 100% (ชื่อต่างก็ได้)
   - ถ้าชื่อคล้ายกัน 70%+ และ Tax ID ต่างกัน → ไม่ Match (คนละบริษัท)

8️⃣ **คำแนะนำสุดท้าย:**
   - ใช้ name + code จาก Master Data เท่านั้น
   - ห้ามใช้ชื่อจาก OCR ถ้า match ได้
   - ระบุ matching_method ให้ถูกต้อง:
     * exact_match: ชื่อเหมือนกันทุกตัวอักษร (หลัง normalize)
     * fuzzy_match: ชื่อคล้ายกัน ≥70%
     * tax_id_match: จับคู่ด้วย Tax ID
     * not_found: ไม่พบใน Master Data
`
}

// GetVendorIdentificationSteps returns steps to identify document issuer
func GetVendorIdentificationSteps() string {
	return `
**ขั้นตอนที่ 0: ระบุชื่อผู้ออกเอกสาร (⚠️ ทำก่อนทุกอย่าง)**
📍 หาชื่อผู้ออกเอกสารจากตำแหน่งเหล่านี้ (เรียงตามความน่าเชื่อถือ):

1. **Header/ส่วนบน** (ความน่าเชื่อถือสูงสุด):
   - มักเป็นชื่อตัวใหญ่/ตัวหนาบนสุดของเอกสาร
   - หาคำว่า: "บริษัท", "ห้างหุ้นส่วน", "หจก.", "บจก.", "ร้าน"
   - ตัวอย่าง: "[ประเภทนิติบุคคล] [ชื่อบริษัท]", "[ย่อ][ชื่อบริษัท]"

2. **เลขประจำตัวผู้เสียภาษี**:
   - หาคำว่า: "เลขประจำตัวผู้เสียภาษี", "Tax ID", "เลขที่ผู้เสียภาษี"
   - ชื่อมักอยู่ใกล้เลขนี้

3. **ชื่อพร้อมที่อยู่ในส่วนบน**:
   - ถ้ามีที่อยู่ยาวๆ ในส่วนบน → ชื่อมักอยู่บรรทัดแรกของที่อยู่นั้น

4. **Footer/ตีนเอกสาร**:
   - บางใบเสร็จใส่ชื่อด้านล่าง (แต่น่าเชื่อถือน้อยกว่า)

⚠️ สิ่งที่ไม่ใช่ชื่อผู้ออก:
- ชื่อสินค้า/บริการ (เช่น "งานจัดทำบัญชี")
- ชื่อพนักงานขาย
- ชื่อที่อยู่ส่วนล่าง (มักเป็นสาขา/จุดบริการ)
`
}
